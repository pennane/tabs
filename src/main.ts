import { Tab } from './model'
import { parseTabs } from './parse'
import { playTab } from './play'
import './style.css'

const app = document.getElementById("app")!
const output = document.createElement('div')
output.classList.add("output")
const input = document.createElement('textarea')

input.value = `e|-----5------------------2-------2----------------------------------------|
B|---------5-3-2----2-3-5---3--------5-3-2--2--0--2--3---------------------|
G|-------------------------------------------------------------------------|
D|-------------------------------------------------------------------------|
A|-------------------------------------------------------------------------|
E|-------------------------------------------------------------------------|
 
e|-----5------------------2-------2--------------2-------------------------|
B|---------5-3-2----2-3-5---3--------5-3-2-0-2-3---5-3-2-0-----------------|
G|---------------------------------------------------------2---------------|
D|-------------------------------------------------------------------------|
A|-------------------------------------------------------------------------|
E|-------------------------------------------------------------------------|
 
e|-------------------------------------------------------------------------|
B|-----2-0-2-2--2-0-2--0--2-------0-2-3-2-0-2------------------------------|
G|------------------------------2------------------------------------------|
D|-------------------------------------------------------------------------|
A|-------------------------------------------------------------------------|
E|-------------------------------------------------------------------------|
 
e|-------------------------------------------------------------------------|
B|-----2-0-2-2--3-2-0--5--2-------0-2-3-2-0-2------------------------------|
G|------------------------------2------------------------------------------|
D|-------------------------------------------------------------------------|
A|-------------------------------------------------------------------------|
E|-------------------------------------------------------------------------|
 
e|--------------------2---------4-4-2--------------------------------------|
B|----5-3-5-5--5-3-5-----5------------5-3-5--------------------------------|
G|-------------------------------------------------------------------------|
D|-------------------------------------------------------------------------|
A|-------------------------------------------------------------------------|
E|-------------------------------------------------------------------------|
 
e|-------------------------------------------------------------------------|
B|-----2-0-2-2--3-2-0--5--2-------0-2-3-2-0--------------------------------|
G|------------------------------2-----------2-----2-----2-----2-----2------|
D|---------------------------------------------2-----2-----2-----2---------|
A|-----------------------------------------(0)---(0)---(0)---(0)---(0)-----|
E|--------------------------------------------(0)---(0)---(0)---(0)--------|`

function insertTabs(tabs: Tab[]) {
    output.innerHTML = ""
    for (const tab of tabs) {
        const wrapper = document.createElement('div')
        wrapper.classList.add("wrapper")
        const view = document.createElement('pre')
        view.textContent = tab.channels.map(c => c.frets.map(f => f === null ? "-" : f.toString()).join('')).join('\n')
        const playButton = document.createElement('button')
        playButton.textContent = "play"
        playButton.addEventListener('click', () => playTab(tab))

        wrapper.appendChild(view)
        wrapper.appendChild(playButton)
        output.appendChild(wrapper)
    }
}


const parseButton = document.createElement('button')
parseButton.textContent = "parse"
parseButton.addEventListener('click', () => {
    const tabs = parseTabs(input.value)
    insertTabs(tabs)
})


app.appendChild(input)
app.appendChild(parseButton)
app.appendChild(output)
